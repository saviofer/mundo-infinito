<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sobreviv√™ncia: Biomas e Evolu√ß√£o</title>
    <style>
        body { margin: 0; overflow: hidden; background: #1a3c1a; font-family: sans-serif; touch-action: none; }
        canvas { display: block; }
        #interface {
            position: absolute; top: 10px; left: 10px; color: white; 
            font-size: 14px; font-weight: bold; pointer-events: none;
            text-shadow: 2px 2px 2px black;
        }
        .barra-container { width: 150px; height: 12px; background: #555; border: 1px solid #fff; margin-top: 5px; }
        #vida-barra { width: 100%; height: 100%; background: #ff5252; transition: 0.2s; }
        #fome-barra { width: 100%; height: 100%; background: #ff9800; transition: 0.2s; }
        
        #inventario {
            position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.6);
            padding: 10px; color: white; border-radius: 5px; font-size: 12px;
        }
        .controles {
            position: absolute; bottom: 20px; left: 20px;
            display: grid; grid-template-columns: repeat(3, 60px); grid-gap: 8px;
        }
        .botoes-acao {
            position: absolute; bottom: 20px; right: 20px;
            display: flex; flex-direction: column; gap: 8px;
        }
        .btn {
            width: 60px; height: 60px; background: rgba(255,255,255,0.2);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: white; font-size: 20px; user-select: none; border: 1px solid white;
        }
        .btn-acao { width: 130px; height: 45px; border-radius: 5px; font-size: 11px; background: #e67e22; color: white; border: 2px solid #fff; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div id="interface">
        Dia: <span id="diaTxt">1</span> | Bioma: <span id="localTxt">Floresta</span><br>
        Vida: <div class="barra-container"><div id="vida-barra"></div></div>
        Fome: <div class="barra-container"><div id="fome-barra"></div></div>
    </div>

    <div id="inventario">
        ü™µ Mad: <span id="madTxt">0</span> | ü™® Ped: <span id="pedTxt">0</span><br>
        ü•© Carne: <span id="carneTxt">0</span><br>
        üõ†Ô∏è <span id="itensTxt">M√£o</span>
    </div>
    
    <div class="controles">
        <div></div><div class="btn" id="up">‚Üë</div><div></div>
        <div class="btn" id="left">‚Üê</div><div class="btn" id="down">‚Üì</div><div class="btn" id="right">‚Üí</div>
    </div>

    <div class="botoes-acao">
        <button id="btn-comer" class="btn-acao" style="background:#27ae60" onclick="comer()">COMER CARNE (ü•©)</button>
        <button id="btn-craft" class="btn-acao" onclick="evoluir()">CRIAR ESPADA (5 Mad)</button>
        <button id="btn-domar" class="btn-acao" style="background:#2980b9" onclick="tentarDomar()">DOMAR (E)</button>
    </div>

    <canvas id="jogoCanvas"></canvas>

    <script>
        const canvas = document.getElementById("jogoCanvas");
        const ctx = canvas.getContext("2d");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let mapaX = 0, mapaY = 0, diaAtual = 1, tempoDecorrido = 0;
        let vida = 100, fome = 100, madeira = 0, pedra = 0, carne = 0;
        let nivel = 0; 
        const jogador = { x: canvas.width/2, y: canvas.height/2, tam: 30, vel: 5, frame: 0 };
        const teclas = {};
        let arvores = [], pedras = [], porcos = [], cactos = [], cachorros = [], zumbis = [];
        let isMoving = false;

        function gerarCenario() {
            arvores = []; pedras = []; porcos = []; cactos = []; zumbis = [];
            
            if (mapaX === 0 && mapaY === 0) {
                document.getElementById("localTxt").innerText = "Floresta";
                arvores = Array.from({length: 8}, () => ({ x: Math.random()*(canvas.width-100)+50, y: Math.random()*(canvas.height-100)+50 }));
                porcos = Array.from({length: 3}, () => ({ x: Math.random()*canvas.width, y: Math.random()*canvas.height }));
                if (cachorros.length === 0) cachorros.push({ x: 300, y: 300, domado: false });
            } 
            else if (mapaX === 1 && mapaY === 0) {
                document.getElementById("localTxt").innerText = "Pedreira";
                pedras = Array.from({length: 10}, () => ({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, r: 25 }));
            }
            else if (mapaX === 0 && mapaY === 1) {
                document.getElementById("localTxt").innerText = "Caverna";
                pedras = Array.from({length: 15}, () => ({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, r: 20 }));
            }
            else if (mapaX === 1 && mapaY === 1) {
                document.getElementById("localTxt").innerText = "Deserto";
                cactos = Array.from({length: 12}, () => ({ x: Math.random()*canvas.width, y: Math.random()*canvas.height }));
            }
        }

        function evoluir() {
            const btn = document.getElementById("btn-craft");
            if (nivel === 0 && madeira >= 5) { madeira -= 5; nivel = 1; btn.innerText = "CRIAR PICARETA (5 Ped)"; }
            else if (nivel === 1 && pedra >= 5) { pedra -= 5; nivel = 2; btn.innerText = "CRIAR MACHADO (10 Mad)"; }
            else if (nivel === 2 && madeira >= 10) { madeira -= 10; nivel = 3; btn.innerText = "CRIAR ESCUDO (10 Ped)"; }
            const nomes = ["M√£o", "Espada ‚öîÔ∏è", "Picareta ‚õèÔ∏è", "Machado ü™ì", "Escudo üõ°Ô∏è"];
            document.getElementById("itensTxt").innerText = nomes[nivel];
            atualizarUI();
        }

        function comer() {
            if (carne > 0 && fome < 100) { carne--; fome = Math.min(100, fome + 30); atualizarUI(); }
        }

        function tentarDomar() {
            cachorros.forEach(c => {
                if (!c.domado && Math.hypot(jogador.x - c.x, jogador.y - c.y) < 70) {
                    c.domado = true;
                    alert("Cachorro domado!");
                }
            });
        }

        function atualizarUI() {
            document.getElementById("madTxt").innerText = madeira;
            document.getElementById("pedTxt").innerText = pedra;
            document.getElementById("carneTxt").innerText = carne;
            document.getElementById("vida-barra").style.width = vida + "%";
            document.getElementById("fome-barra").style.width = fome + "%";
            document.getElementById("diaTxt").innerText = diaAtual;
        }

        function drawPlayer() {
            ctx.save();
            ctx.translate(jogador.x + 15, jogador.y + 15);
            ctx.fillStyle = "#00e5ff";
            let legMovement = isMoving ? Math.sin(jogador.frame * 0.2) * 8 : 0;
            ctx.fillRect(-8, -10, 16, 20);
            ctx.beginPath(); ctx.arc(0, -18, 10, 0, 7); ctx.fill();
            ctx.fillRect(-7, 10, 5, 10 + legMovement);
            ctx.fillRect(2, 10, 5, 10 - legMovement);
            if (nivel === 4) {
                ctx.strokeStyle = "white"; ctx.lineWidth = 3;
                ctx.beginPath(); ctx.arc(-18, 0, 12, 0, 7); ctx.stroke();
            }
            ctx.restore();
        }

        function drawDog(dog) {
            ctx.save();
            ctx.translate(dog.x, dog.y);
            let lookDir = (jogador.x < dog.x) ? -1 : 1;
            ctx.scale(lookDir, 1);
            ctx.fillStyle = "#a1887f";
            ctx.fillRect(-10, -8, 22, 14);
            ctx.fillRect(8, -15, 12, 10);
            if(dog.domado) {
                ctx.fillStyle = "red";
                ctx.fillRect(8, -7, 3, 10);
            }
            ctx.restore();
        }

        function drawZombie(z) {
            ctx.save();
            ctx.translate(z.x, z.y);
            ctx.fillStyle = "#4caf50";
            ctx.fillRect(-8, -10, 16, 20);
            ctx.beginPath(); ctx.arc(0, -18, 10, 0, 7); ctx.fill();
            ctx.fillStyle = "white"; ctx.fillRect(2, -20, 3, 3);
            ctx.restore();
        }

        function loop() {
            tempoDecorrido += 0.5;
            jogador.frame++;
            fome -= 0.005;
            if (fome <= 0) { fome = 0; vida -= 0.05; }
            if (vida <= 0) { alert("Game Over!"); location.reload(); }
            atualizarUI();

            // Movimenta√ß√£o
            let oldX = jogador.x; let oldY = jogador.y;
            if (teclas["ArrowUp"] || teclas["w"]) jogador.y -= jogador.vel;
            if (teclas["ArrowDown"] || teclas["s"]) jogador.y += jogador.vel;
            if (teclas["ArrowLeft"] || teclas["a"]) jogador.x -= jogador.vel;
            if (teclas["ArrowRight"] || teclas["d"]) jogador.x += jogador.vel;
            isMoving = (jogador.x !== oldX || jogador.y !== oldY);

            // Troca de Mapa
            if (jogador.x > canvas.width) { mapaX++; jogador.x = 20; gerarCenario(); }
            if (jogador.x < -30) { mapaX--; jogador.x = canvas.width - 40; gerarCenario(); }
            if (jogador.y > canvas.height) { mapaY--; jogador.y = 20; gerarCenario(); }
            if (jogador.y < -30) { mapaY++; jogador.y = canvas.height - 40; gerarCenario(); }

            // Fundo
            let corChao = "#3a9d5d";
            if(mapaX === 1 && mapaY === 0) corChao = "#888";
            if(mapaX === 0 && mapaY === 1) corChao = "#333";
            if(mapaX === 1 && mapaY === 1) corChao = "#edc9af";
            ctx.fillStyle = corChao; ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Cactos (Desenho e Dano)
            cactos.forEach(c => {
                ctx.fillStyle = "#2ecc71"; 
                ctx.fillRect(c.x, c.y, 15, 30); // Corpo
                ctx.fillRect(c.x-5, c.y+10, 5, 10); // Bra√ßo 1
                ctx.fillRect(c.x+15, c.y+5, 5, 10); // Bra√ßo 2
                if(Math.hypot(jogador.x-c.x, jogador.y-c.y) < 25) vida -= 0.2;
            });

            // Pedras (Desenho e Coleta)
            pedras.forEach((p, i) => {
                ctx.fillStyle = "#666";
                ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, 7); ctx.fill();
                ctx.fillStyle = "#888"; // Detalhe da pedra
                ctx.beginPath(); ctx.arc(p.x-5, p.y-5, p.r/2, 0, 7); ctx.fill();
                if(Math.hypot(jogador.x-p.x, jogador.y-p.y) < 35) { pedras.splice(i, 1); pedra++; atualizarUI(); }
            });

            // Arvores
            arvores.forEach((a, i) => {
                ctx.fillStyle = "#5d4037"; ctx.fillRect(a.x+15, a.y+20, 10, 20);
                ctx.fillStyle = "#2e7d32"; ctx.beginPath(); ctx.arc(a.x+20, a.y+15, 20, 0, 7); ctx.fill();
                if(Math.hypot(jogador.x-a.x, jogador.y-a.y) < 40) { arvores.splice(i, 1); madeira++; atualizarUI(); }
            });

            // Porcos
            porcos.forEach((p, i) => {
                ctx.fillStyle = "#ffafbd"; ctx.fillRect(p.x, p.y, 20, 15);
                if(Math.hypot(jogador.x-p.x, jogador.y-p.y) < 30) { porcos.splice(i, 1); carne++; atualizarUI(); }
            });

            // Zumbis
            if ((tempoDecorrido > 1200 || (mapaX === 0 && mapaY === 1)) && zumbis.length < 4) {
                if (Math.random() < 0.005) zumbis.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height });
            }
            zumbis.forEach((z, i) => {
                let d = Math.hypot(jogador.x - z.x, jogador.y - z.y);
                z.x += (jogador.x - z.x) * 0.01;
                z.y += (jogador.y - z.y) * 0.01;
                drawZombie(z);
                if (d < 30) { 
                    if(nivel >= 1) zumbis.splice(i, 1); 
                    else vida -= 0.2; 
                }
            });

            // Cachorro
            cachorros.forEach(dog => {
                if (dog.domado) {
                    if (zumbis.length > 0) {
                        let z = zumbis[0];
                        dog.x += (z.x - dog.x) * 0.06;
                        dog.y += (z.y - dog.y) * 0.06;
                        if (Math.hypot(dog.x - z.x, dog.y - z.y) < 30) zumbis.splice(0, 1);
                    } else if (Math.hypot(jogador.x - dog.x, jogador.y - dog.y) > 60) {
                        dog.x += (jogador.x - dog.x) * 0.04;
                        dog.y += (jogador.y - dog.y) * 0.04;
                    }
                }
                drawDog(dog);
            });

            if(mapaX === 0 && mapaY === 0) {
                ctx.fillStyle = "#ffeb3b"; ctx.fillRect(80, 80, 50, 25);
                if(Math.hypot(jogador.x-105, jogador.y-92) < 40 && tempoDecorrido > 1200) { 
                    tempoDecorrido = 0; diaAtual++; alert("Novo Dia!"); gerarCenario(); 
                }
            }

            drawPlayer();

            // Escurid√£o
            let escurecimento = tempoDecorrido < 1200 ? 0 : Math.min((tempoDecorrido - 1200) / 2000, 0.85);
            if (mapaX === 0 && mapaY === 1) escurecimento = 0.92;
            ctx.fillStyle = `rgba(0,0,20,${escurecimento})`;
            ctx.fillRect(0,0,canvas.width,canvas.height);

            requestAnimationFrame(loop);
        }

        window.onkeydown = (e) => { teclas[e.key] = true; if(e.key.toLowerCase() === 'e') tentarDomar(); };
        window.onkeyup = (e) => teclas[e.key] = false;
        gerarCenario(); loop();
    </script>
</body>
</html>
