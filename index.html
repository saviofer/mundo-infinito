<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sobreviv√™ncia: Biomas e Evolu√ß√£o</title>
    <style>
        body { margin: 0; overflow: hidden; background: #1a3c1a; font-family: sans-serif; touch-action: none; }
        canvas { display: block; }
        #interface {
            position: absolute; top: 10px; left: 10px; color: white; 
            font-size: 14px; font-weight: bold; pointer-events: none;
            text-shadow: 2px 2px 2px black;
        }
        .barra-container { width: 150px; height: 12px; background: #555; border: 1px solid #fff; margin-top: 5px; }
        #vida-barra { width: 100%; height: 100%; background: #ff5252; transition: 0.2s; }
        #fome-barra { width: 100%; height: 100%; background: #ff9800; transition: 0.2s; }
        
        #inventario {
            position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.6);
            padding: 10px; color: white; border-radius: 5px; font-size: 12px;
        }
        .controles {
            position: absolute; bottom: 20px; left: 20px;
            display: grid; grid-template-columns: repeat(3, 60px); grid-gap: 8px;
        }
        .botoes-acao {
            position: absolute; bottom: 20px; right: 20px;
            display: flex; flex-direction: column; gap: 8px;
        }
        .btn {
            width: 60px; height: 60px; background: rgba(255,255,255,0.2);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: white; font-size: 20px; user-select: none; border: 1px solid white;
        }
        .btn-acao { width: 130px; height: 45px; border-radius: 5px; font-size: 11px; background: #e67e22; color: white; border: 2px solid #fff; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div id="interface">
        Dia: <span id="diaTxt">1</span> | Bioma: <span id="localTxt">Floresta</span><br>
        Vida: <div class="barra-container"><div id="vida-barra"></div></div>
        Fome: <div class="barra-container"><div id="fome-barra"></div></div>
    </div>

    <div id="inventario">
        ü™µ Mad: <span id="madTxt">0</span> | ü™® Ped: <span id="pedTxt">0</span><br>
        ü•© Carne: <span id="carneTxt">0</span><br>
        üõ†Ô∏è <span id="itensTxt">M√£o</span>
    </div>
    
    <div class="controles">
        <div></div><div class="btn" id="up">‚Üë</div><div></div>
        <div class="btn" id="left">‚Üê</div><div class="btn" id="down">‚Üì</div><div class="btn" id="right">‚Üí</div>
    </div>

    <div class="botoes-acao">
        <button id="btn-comer" class="btn-acao" style="background:#27ae60" onclick="comer()">COMER CARNE (ü•©)</button>
        <button id="btn-craft" class="btn-acao" onclick="evoluir()">CRIAR ESPADA (5 Mad)</button>
    </div>

    <canvas id="jogoCanvas"></canvas>

    <script>
        const canvas = document.getElementById("jogoCanvas");
        const ctx = canvas.getContext("2d");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let mapaX = 0, mapaY = 0, diaAtual = 1, tempoDecorrido = 0;
        let vida = 100, fome = 100, madeira = 0, pedra = 0, carne = 0;
        let nivel = 0; 
        let coletadosNoDia = { madeira: 0, pedra: 0, carne: 0 };

        const jogador = { x: canvas.width/2, y: canvas.height/2, tam: 30, vel: 5, frame: 0 }; // Adicionado 'frame' para anima√ß√£o
        const teclas = {};
        let arvores = [], pedras = [], porcos = [], zumbis = [], cactos = [];
        let isMoving = false; // Para controlar a anima√ß√£o do personagem

        function gerarCenario() {
            arvores = []; pedras = []; zumbis = []; porcos = []; cactos = [];
            
            // L√ìGICA DE BIOMAS POR COORDENADA
            if (mapaX === 0 && mapaY === 0) {
                document.getElementById("localTxt").innerText = "Floresta";
                arvores = Array.from({length: 8}, () => ({ x: Math.random()*(canvas.width-50), y: Math.random()*(canvas.height-50) }));
                porcos = Array.from({length: 3}, () => ({ x: Math.random()*canvas.width, y: Math.random()*canvas.height }));
            } 
            else if (mapaX === 1 && mapaY === 0) {
                document.getElementById("localTxt").innerText = "Pedreira";
                pedras = Array.from({length: 10}, () => ({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, r: 25 }));
            }
            else if (mapaX === 0 && mapaY === 1) {
                document.getElementById("localTxt").innerText = "Caverna";
                pedras = Array.from({length: 15}, () => ({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, r: 20 }));
            }
            else if (mapaX === 1 && mapaY === 1) {
                document.getElementById("localTxt").innerText = "Deserto";
                cactos = Array.from({length: 12}, () => ({ x: Math.random()*canvas.width, y: Math.random()*canvas.height }));
                porcos = Array.from({length: 1}, () => ({ x: Math.random()*canvas.width, y: Math.random()*canvas.height }));
            }
        }

        function evoluir() {
            const btn = document.getElementById("btn-craft");
            if (nivel === 0 && madeira >= 5) { madeira -= 5; nivel = 1; btn.innerText = "CRIAR PICARETA (5 Ped)"; }
            else if (nivel === 1 && pedra >= 5) { pedra -= 5; nivel = 2; btn.innerText = "CRIAR MACHADO (10 Mad)"; }
            else if (nivel === 2 && madeira >= 10) { madeira -= 10; nivel = 3; btn.innerText = "CRIAR ESCUDO (10 Ped)"; }
            const nomes = ["M√£o", "Espada ‚öîÔ∏è", "Picareta ‚õèÔ∏è", "Machado ü™ì", "Escudo üõ°Ô∏è"];
            document.getElementById("itensTxt").innerText = nomes[nivel];
            atualizarUI();
        }

        function comer() {
            if (carne > 0 && fome < 100) { carne--; fome = Math.min(100, fome + 30); atualizarUI(); }
        }

        function atualizarUI() {
            document.getElementById("madTxt").innerText = madeira;
            document.getElementById("pedTxt").innerText = pedra;
            document.getElementById("carneTxt").innerText = carne;
            document.getElementById("vida-barra").style.width = vida + "%";
            document.getElementById("fome-barra").style.width = fome + "%";
            document.getElementById("diaTxt").innerText = diaAtual;
        }

        function desenharSetaCama() {
            let alvoX = (0 - mapaX) * canvas.width + 105;
            let alvoY = (0 - mapaY) * -canvas.height + 92; 
            let dx = alvoX - jogador.x;
            let dy = alvoY - jogador.y;
            let angulo = Math.atan2(dy, dx);
            ctx.save();
            ctx.translate(jogador.x + 15, jogador.y + 15);
            ctx.rotate(angulo);
            ctx.fillStyle = "white";
            ctx.beginPath(); ctx.moveTo(40, 0); ctx.lineTo(30, -10); ctx.lineTo(30, 10); ctx.fill();
            ctx.restore();
        }
        
        // NOVA FUN√á√ÉO PARA DESENHAR O PERSONAGEM
        function drawPlayer() {
            ctx.save();
            ctx.translate(jogador.x + jogador.tam / 2, jogador.y + jogador.tam / 2); // Centraliza a origem
            ctx.fillStyle = "#00e5ff"; // Cor do personagem

            // Anima√ß√£o simples de movimento
            let armOffset = isMoving ? Math.sin(jogador.frame * 0.1) * 5 : 0;
            let legOffset = isMoving ? Math.sin(jogador.frame * 0.1 + Math.PI) * 5 : 0; // Pernas opostas aos bra√ßos

            // Corpo
            ctx.fillRect(-5, -10, 10, 20); // Corpo central

            // Cabe√ßa
            ctx.beginPath();
            ctx.arc(0, -15, 8, 0, Math.PI * 2);
            ctx.fill();

            // Bra√ßos
            ctx.fillRect(-10, -8 + armOffset, 5, 15); // Bra√ßo esquerdo
            ctx.fillRect(5, -8 - armOffset, 5, 15);  // Bra√ßo direito

            // Pernas
            ctx.fillRect(-8, 10 + legOffset, 5, 15); // Perna esquerda
            ctx.fillRect(3, 10 - legOffset, 5, 15); // Perna direita

            // Escudo (se n√≠vel 4)
            if (nivel === 4) {
                ctx.strokeStyle = "white";
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(-15, -5, 10, 0, Math.PI * 2); // Desenha um escudo circular
                ctx.stroke();
            }

            ctx.restore();
        }

        window.onkeydown = (e) => { teclas[e.key] = true; isMoving = true; };
        window.onkeyup = (e) => { teclas[e.key] = false; if (!Object.values(teclas).some(v => v)) isMoving = false; };
        const configurarBotao = (id, tecla) => {
            const el = document.getElementById(id);
            el.ontouchstart = (e) => { e.preventDefault(); teclas[tecla] = true; isMoving = true; };
            el.ontouchend = () => { teclas[tecla] = false; if (!Object.values(teclas).some(v => v)) isMoving = false; };
        };
        ["up","down","left","right"].forEach(id => configurarBotao(id, "Arrow" + id.charAt(0).toUpperCase() + id.slice(1)));

        function loop() {
            tempoDecorrido += 0.5;
            jogador.frame++; // Incrementa o frame para a anima√ß√£o
            fome -= 0.005;
            if (fome <= 0) { fome = 0; vida -= 0.05; }
            if (vida <= 0) { alert("Voc√™ morreu!"); location.reload(); }
            atualizarUI();

            // Guarda a posi√ß√£o antiga para verificar movimento
            let oldX = jogador.x;
            let oldY = jogador.y;

            // Movimenta√ß√£o
            if (teclas["ArrowUp"] || teclas["w"]) jogador.y -= jogador.vel;
            if (teclas["ArrowDown"] || teclas["s"]) jogador.y += jogador.vel;
            if (teclas["ArrowLeft"] || teclas["a"]) jogador.x -= jogador.vel;
            if (teclas["ArrowRight"] || teclas["d"]) jogador.x += jogador.vel;

            // Verifica se o jogador realmente se moveu neste frame
            if (jogador.x === oldX && jogador.y === oldY) {
                isMoving = false;
            } else {
                isMoving = true;
            }


            // Troca de Mapa
            if (jogador.x > canvas.width) { mapaX++; jogador.x = 20; gerarCenario(); }
            if (jogador.x < -30) { mapaX--; jogador.x = canvas.width - 40; gerarCenario(); }
            if (jogador.y > canvas.height) { mapaY--; jogador.y = 20; gerarCenario(); }
            if (jogador.y < -30) { mapaY++; jogador.y = canvas.height - 40; gerarCenario(); }

            // COR DO CH√ÉO POR BIOMA
            let corChao = "#3a9d5d"; // Floresta
            if(mapaX === 1 && mapaY === 0) corChao = "#888"; // Pedreira
            if(mapaX === 0 && mapaY === 1) corChao = "#333"; // Caverna
            if(mapaX === 1 && mapaY === 1) corChao = "#edc9af"; // Deserto
            
            ctx.fillStyle = corChao;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Cactos (Dano)
            cactos.forEach(c => {
                ctx.fillStyle = "#2ecc71"; ctx.fillRect(c.x, c.y, 15, 30);
                ctx.fillStyle = "#27ae60"; ctx.fillRect(c.x-5, c.y+5, 5, 10); ctx.fillRect(c.x+15, c.y+10, 5, 10);
                if(Math.hypot(jogador.x-c.x, jogador.y-c.y) < 25) vida -= 0.2;
            });

            // Porcos
            porcos.forEach((p, i) => {
                ctx.fillStyle = "#ffafbd"; ctx.fillRect(p.x, p.y, 20, 15);
                if(Math.hypot(jogador.x-p.x, jogador.y-p.y) < 30) { porcos.splice(i, 1); carne++; coletadosNoDia.carne++; atualizarUI(); }
            });

            // √Årvores
            arvores.forEach((a, i) => {
                ctx.fillStyle = "#5d4037"; ctx.fillRect(a.x+15, a.y+20, 10, 20);
                ctx.fillStyle = "#2e7d32"; ctx.beginPath(); ctx.arc(a.x+20, a.y+15, 20, 0, 7); ctx.fill();
                if(Math.hypot(jogador.x-a.x, jogador.y-a.y) < 40) { arvores.splice(i, 1); madeira++; coletadosNoDia.madeira++; atualizarUI(); }
            });

            // Pedras
            pedras.forEach((p, i) => {
                ctx.fillStyle = "#666"; ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, 7); ctx.fill();
                if(Math.hypot(jogador.x-p.x, jogador.y-p.y) < 30) { pedras.splice(i, 1); pedra++; coletadosNoDia.pedra++; atualizarUI(); }
            });

            // Cama
            if(mapaX === 0 && mapaY === 0) {
                ctx.fillStyle = "#ffeb3b"; ctx.fillRect(80, 80, 50, 25);
                if(Math.hypot(jogador.x-105, jogador.y-92) < 40 && tempoDecorrido > 1200) { 
                    alert(`BOM DIA!\n\nColetado hoje:\nü™µ Mad: ${coletadosNoDia.madeira}\nü™® Ped: ${coletadosNoDia.pedra}\nü•© Carne: ${coletadosNoDia.carne}`);
                    tempoDecorrido = 0; diaAtual++; coletadosNoDia = { madeira: 0, pedra: 0, carne: 0 }; atualizarUI(); 
                }
            }

            // Desenha o Jogador e a Seta
            drawPlayer(); // CHAMA A NOVA FUN√á√ÉO AQUI
            desenharSetaCama();

            // SISTEMA DE ESCURID√ÉO (Ciclo dia/noite ou Caverna)
            let escurecimento = tempoDecorrido < 1200 ? 0 : Math.min((tempoDecorrido - 1200) / 2000, 0.85);
            if (mapaX === 0 && mapaY === 1) escurecimento = 0.92; // Caverna √© sempre escura
            
            ctx.fillStyle = `rgba(0,0,20,${escurecimento})`;
            ctx.fillRect(0,0,canvas.width,canvas.height);

            requestAnimationFrame(loop);
        }
        gerarCenario(); loop();
    </script>
</body>
</html>
